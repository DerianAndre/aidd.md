# Implementation Plan: Hub Memory Service — DDD + Hexagonal Architecture

> **Last Updated**: 2026-02-07
> **Status**: In Progress (retroactive — implementation preceded plan)

---

## Table of Contents

1. [Overview](#1-overview)
2. [Phase 1: Domain Layer](#2-phase-1-domain-layer)
3. [Phase 2: Application Layer](#3-phase-2-application-layer)
4. [Phase 3: Infrastructure Adapters](#4-phase-3-infrastructure-adapters)
5. [Phase 4: Presentation Layer](#5-phase-4-presentation-layer)
6. [Phase 5: Frontend Integration](#6-phase-5-frontend-integration)
7. [Verification](#7-verification)

---

## 1. Overview

Add memory data visualization to the Hub app by implementing a proper DDD + Hexagonal architecture for the memory bounded context. The Hub queries the active project's `.aidd/data.db` SQLite database directly.

**Guiding principles**:
- Follow existing Rust Hexagonal patterns (domain/application/infrastructure/presentation)
- Pure domain layer — zero framework dependencies
- Adapter swappability (SQLite now, MCP client later)
- Graceful degradation when no project or database exists

---

## 2. Phase 1: Domain Layer (Sequential)

| # | Task | Files | Complexity | Tier | Status |
|---|------|-------|-----------|------|--------|
| 1.1 | Define MemoryPort trait | `domain/ports/inbound/memory_port.rs` | Medium | 2 | Done |
| 1.2 | Define value objects | `domain/ports/inbound/memory_port.rs` | Low | 3 | Done |
| 1.3 | Export from mod.rs | `domain/ports/inbound/mod.rs` | Low | 3 | Done |

Value objects: `SessionSummary`, `SessionInfo`, `ObservationEntry`, `EvolutionStatus`, `PatternStats`.

---

## 3. Phase 2: Application Layer (Sequential, depends on Phase 1)

| # | Task | Files | Complexity | Tier | Status |
|---|------|-------|-----------|------|--------|
| 2.1 | Create MemoryService | `application/memory_service.rs` | Medium | 2 | Done |
| 2.2 | Export from mod.rs | `application/mod.rs` | Low | 3 | Done |

MemoryService depends only on `Box<dyn MemoryPort>`. No framework knowledge.

---

## 4. Phase 3: Infrastructure Adapters (Parallel)

| # | Task | Files | Complexity | Tier | Status |
|---|------|-------|-----------|------|--------|
| 3.1 | Create McpMemoryAdapter (stub) | `infrastructure/adapters/mcp_memory_adapter.rs` | Low | 3 | Done |
| 3.2 | Create SqliteMemoryAdapter | `infrastructure/adapters/sqlite_memory_adapter.rs` | High | 2 | Done |
| 3.3 | Wire active project path | `infrastructure/adapters/sqlite_memory_adapter.rs` | Medium | 2 | Done |
| 3.4 | Export from mod.rs | `infrastructure/adapters/mod.rs` | Low | 3 | Done |

Steps 3.1 and 3.2 are independent (parallel).
Step 3.3 depends on 3.2 and ProjectService.

---

## 5. Phase 4: Presentation Layer (Sequential, depends on Phases 2-3)

| # | Task | Files | Complexity | Tier | Status |
|---|------|-------|-----------|------|--------|
| 4.1 | Create Tauri memory commands | `presentation/commands/memory_commands.rs` | Medium | 2 | Done |
| 4.2 | Register commands in lib.rs | `lib.rs` | Low | 3 | Done |
| 4.3 | Wire adapter + service in lib.rs | `lib.rs` | Medium | 2 | Done |

5 commands: `get_memory_snapshot`, `get_sessions`, `get_evolution_status`, `get_pattern_stats`, `search_observations`.

---

## 6. Phase 5: Frontend Integration (Sequential, depends on Phase 4)

| # | Task | Files | Complexity | Tier | Status |
|---|------|-------|-----------|------|--------|
| 5.1 | Define TypeScript types | `features/memory/types.ts` | Low | 3 | Done |
| 5.2 | Create Zustand memory store | `features/memory/stores/memory-store.ts` | Medium | 2 | Done |
| 5.3 | Create MemoryPanel component | `features/memory/components/memory-panel.tsx` | Medium | 2 | Done |
| 5.4 | Integrate into dashboard | `features/dashboard/` | Low | 3 | Done |

---

## 7. Verification

| Check | Status |
|-------|--------|
| `cargo check` (Rust) | Pass (9 warnings — expected for stubs) |
| `pnpm mcp:typecheck` (TypeScript) | Pass |
| `pnpm mcp:build` (MCP packages) | Pass |
| Architecture: dependency rule (inward only) | Pass |
| Architecture: domain has zero deps | Pass |
| Graceful degradation (no DB) | Pass (returns empty data) |

---

## Commits

- 8969e95 fix(core): allow project specs when bundledRoot is null
- 751f10c fix(critical): await SQLite backend initialization
- 841c12b feat: implement memory infrastructure for Hub dashboard
- ba24a4a refactor: implement DDD + Hexagonal Architecture for memory service
- 14ccf88 feat(hub/memory): wire active project database path

---

## Completed (Batch 2)

| # | Task | Complexity | Tier | Status |
|---|------|-----------|------|--------|
| P2 | Database schema verification before queries | Medium | 2 | Done |
| P3 | Error state UI in MemoryPanel | Low | 3 | Done |
| P4 | Integration tests (7 Rust unit tests) | Medium | 2 | Done |
| P1 | Implement McpMemoryAdapter (JSON-RPC client) | High | 1 | Done |
