# Diagrams: Best DX — Zero-Friction Developer Experience

> Mermaid diagrams for the unified setup flow.
> **Date**: 2026-02-07

---

## 1. Setup Flow

```mermaid
flowchart TD
    START[pnpm setup] --> S1[1/7 Check Prerequisites]
    S1 -->|Node 22+ ✅| S2[2/7 Install Dependencies]
    S1 -->|Node < 22 ❌| FAIL[Exit with error]
    S2 --> S3[3/7 Build MCP Packages]
    S3 --> S4[4/7 Initialize .aidd/]
    S4 --> S5[5/7 Detect IDEs]

    S5 --> DET{IDEs Found?}
    DET -->|Yes| SHOW[Show detected list]
    DET -->|No| SKIP[Skip — suggest manual]

    SHOW --> CONFIRM{Configure? Y/n}
    CONFIRM -->|Y| WRITE[Write MCP configs]
    CONFIRM -->|n| SKIP

    WRITE --> CHECK{Contributor?}
    CHECK -->|dist/index.js exists| LOCAL[Local path config]
    CHECK -->|dist/ not found| NPX[npx config]
    LOCAL --> S6
    NPX --> S6

    SKIP --> S6[6/7 Run mcp:doctor]
    S6 --> S7[7/7 Summary]
    S7 --> DONE[Setup Complete ✅]

    style START fill:#4CAF50,color:#fff
    style DONE fill:#4CAF50,color:#fff
    style FAIL fill:#f44336,color:#fff
    style WRITE fill:#2196F3,color:#fff
    style LOCAL fill:#FF9800,color:#fff
    style NPX fill:#9C27B0,color:#fff
```

---

## 2. Smart Path Detection

```mermaid
graph LR
    subgraph "Detection"
        CHECK[Check mcps/.../dist/index.js]
    end

    subgraph "Contributor Mode"
        LOCAL["command: node<br/>args: [abs-path/dist/index.js]<br/>Cold start: <1s"]
    end

    subgraph "Adopter Mode"
        NPX["command: npx<br/>args: [-y, @aidd.md/mcp-engine]<br/>Cold start: ~3-5s"]
    end

    CHECK -->|exists| LOCAL
    CHECK -->|not found| NPX

    style LOCAL fill:#4CAF50,color:#fff
    style NPX fill:#9C27B0,color:#fff
```

---

## 3. IDE Config Flow

```mermaid
graph TD
    subgraph "Detection"
        D1[~/.claude/ exists?] -->|Yes| CC[Claude Code]
        D2[Always available] --> CU[Cursor]
        D3[.vscode/ or code CLI?] -->|Yes| VS[VS Code]
        D4[AGENTS.md exists?] -->|Yes| GE[Gemini]
    end

    subgraph "Config Locations"
        CC --> CF1["~/.claude/mcp.json<br/>(global)"]
        CU --> CF2[".cursor/mcp.json<br/>(project)"]
        VS --> CF3[".vscode/mcp.json<br/>(project)"]
        GE --> CF4["AGENTS.md<br/>(auto-detected)"]
    end

    subgraph "MCP Auto-Start"
        CF1 --> AS1["IDE reads config →<br/>spawns MCP engine"]
        CF2 --> AS1
        CF3 --> AS1
        CF4 -.->|"Gemini reads<br/>AGENTS.md directly"| AS2["No MCP needed"]
    end

    style AS1 fill:#4CAF50,color:#fff
    style AS2 fill:#607D8B,color:#fff
```

---

## 4. Developer Journey

```mermaid
sequenceDiagram
    participant Dev as Developer
    participant Setup as pnpm setup
    participant IDE as IDE (Claude/Cursor/VS Code)
    participant MCP as MCP Engine (69 tools)

    Note over Dev,MCP: === One-Time Setup ===

    Dev->>Setup: pnpm setup
    Setup->>Setup: [1/7] Check Node 22+, pnpm 10+
    Setup->>Setup: [2/7] Install all deps
    Setup->>Setup: [3/7] Build MCP packages
    Setup->>Setup: [4/7] Init .aidd/
    Setup->>Dev: [5/7] Detected: Claude Code, Cursor, VS Code
    Dev->>Setup: Y (confirm)
    Setup->>Setup: Write ~/.claude/mcp.json
    Setup->>Setup: Write .cursor/mcp.json
    Setup->>Setup: Write .vscode/mcp.json
    Setup->>Setup: [6/7] Run mcp:doctor ✅
    Setup->>Dev: [7/7] Setup Complete!

    Note over Dev,MCP: === Every Day After ===

    Dev->>IDE: Open IDE
    IDE->>IDE: Read mcp.json
    IDE->>MCP: Spawn MCP engine (auto)
    MCP->>MCP: Load 69 tools
    MCP-->>IDE: Ready
    Dev->>IDE: Start coding
    IDE->>MCP: aidd_session start
    MCP-->>IDE: Session active
```

---

## 5. Entry Points

```mermaid
graph TB
    subgraph "Contributors"
        C1[git clone aidd.md] --> C2[pnpm install]
        C2 --> C3[pnpm setup]
        C3 --> C4[Open IDE → Code]
    end

    subgraph "Adopters — CLI"
        A1[cd my-project] --> A2[npx @aidd.md/cli init]
        A2 --> A3[Open IDE → Code]
    end

    subgraph "Adopters — Manual"
        M1[Copy AGENTS.md + content/] --> M2[Open IDE → Code]
    end

    C4 --> WORK[MCPs auto-start<br/>69 tools available]
    A3 --> WORK
    M2 -.->|"Manual MCP config<br/>still needed"| WORK

    style C3 fill:#4CAF50,color:#fff
    style A2 fill:#2196F3,color:#fff
    style WORK fill:#FF9800,color:#fff
```
