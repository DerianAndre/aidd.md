# Architecture Diagrams: Hub Marketplace

> Mermaid diagrams for the AIDD Hub Marketplace feature.
> **Last Updated**: 2026-02-06

---

## 1. High-Level Architecture

```mermaid
graph TB
    subgraph "Remote"
        REG["GitHub Registry<br/>aidd-md/registry<br/>*.json files"]
    end

    subgraph "Hub App (Tauri 2 + React 19)"
        direction TB

        subgraph "Feature: Marketplace"
            direction TB

            subgraph "Pages"
                MP[MarketplacePage<br/>tabs · filters · grid/list]
                DP[MarketplaceDetailPage<br/>info · install · markdown]
            end

            subgraph "Components"
                CARD[MarketplaceCard]
                TABLE[MarketplaceTable]
                FBAR[FilterBar<br/>search · chips · sort · toggle]
                INST[InstallSnippet<br/>copy-to-clipboard]
                DIAL[InstallDialog<br/>Tauri file-write]
                TAGS[TagCloud]
                STATS[StatCards]
            end

            subgraph "State"
                STORE[marketplace-store<br/>Zustand]
            end

            subgraph "Lib"
                TYPES[types.ts]
                CONST[constants.ts]
                RMOD[registry.ts<br/>fetch · cache · fallback]
                HELP[catalog-helpers.ts<br/>filter · sort · search]
            end
        end

        subgraph "Shared"
            ROUTER[React Router]
            UI[shadcn/ui components]
            TAURI[Tauri APIs<br/>fs · dialog]
        end
    end

    REG -->|fetch JSON| RMOD
    RMOD -->|catalog data| STORE
    STORE -->|derived state| MP & DP
    MP --> CARD & TABLE & FBAR & STATS
    DP --> INST & DIAL & TAGS
    STORE -->|filter/sort| HELP
    DIAL -->|file write| TAURI
    MP & DP --> ROUTER
    CARD & TABLE & FBAR --> UI

    style REG fill:#bbf,stroke:#333,stroke-width:2px
    style STORE fill:#fbf,stroke:#333,stroke-width:2px
    style RMOD fill:#bfb,stroke:#333
```

---

## 2. Data Flow

```mermaid
sequenceDiagram
    participant User
    participant Page as MarketplacePage
    participant Store as Zustand Store
    participant Reg as registry.ts
    participant GH as GitHub Raw URL
    participant Static as Static Fallback

    User->>Page: Navigate to /marketplace
    Page->>Store: useMarketplaceStore()

    alt First load
        Store->>Reg: fetchCatalog()
        Reg->>GH: GET *.json
        alt Success
            GH-->>Reg: JSON data
            Reg-->>Store: catalog entries
        else Fetch fails
            GH-->>Reg: error/timeout
            Reg->>Static: load fallback
            Static-->>Reg: seed data
            Reg-->>Store: catalog + stale flag
        end
    end

    Store-->>Page: entries + filters + stats

    User->>Page: Type search / click filter
    Page->>Store: setSearch() / setCategory()
    Store->>Store: recompute filtered entries
    Store-->>Page: filtered results

    User->>Page: Click entry card
    Page->>Page: navigate to /marketplace/:type/:slug

    User->>Page: Click "Copy config"
    Page->>Page: clipboard.writeText(configJSON)

    User->>Page: Click "Install directly"
    Page->>Page: open InstallDialog
    User->>Page: Select config target
    Page->>Page: Tauri fs.writeTextFile()
```

---

## 3. Type System

```mermaid
classDiagram
    class MarketplaceEntry {
        <<discriminated union>>
        type: "mcp-server" | "content"
    }

    class McpServerEntry {
        type: "mcp-server"
        slug: string
        name: string
        description: string
        author: string
        category: McpCategory
        tags: string[]
        installConfig: object
        transport: "stdio" | "http"
        features: string[]
        configTargets: ConfigTarget[]
        installCount: number
        trending: boolean
    }

    class ContentEntry {
        type: "content"
        slug: string
        name: string
        description: string
        author: string
        contentType: ContentType
        tags: string[]
        content: string
        agentCompatibility: string[]
        installCount: number
    }

    class ConfigTarget {
        name: string
        path: string
        format: "json" | "yaml"
    }

    class ContentType {
        <<enumeration>>
        skill
        workflow
        rule
        template
        knowledge
    }

    class McpCategory {
        <<enumeration>>
        development
        productivity
        data
        ai
        infrastructure
        other
    }

    MarketplaceEntry <|-- McpServerEntry
    MarketplaceEntry <|-- ContentEntry
    McpServerEntry --> ConfigTarget
    ContentEntry --> ContentType
    McpServerEntry --> McpCategory
```

---

## 4. File Structure

```mermaid
graph TD
    ROOT["apps/hub/src/features/marketplace/"]

    subgraph "lib/ (Pure Logic)"
        L1[types.ts<br/>Entry types, filters, registry]
        L2[constants.ts<br/>Categories, sort options, URLs]
        L3[registry.ts<br/>Fetch, cache, fallback]
        L4[catalog-helpers.ts<br/>filter, sort, search, stats]
    end

    subgraph "stores/ (State)"
        S1[marketplace-store.ts<br/>Zustand: catalog + filters]
    end

    subgraph "components/ (UI)"
        C1[marketplace-card.tsx]
        C2[marketplace-table.tsx]
        C3[filter-bar.tsx]
        C4[install-snippet.tsx]
        C5[install-dialog.tsx]
        C6[tag-cloud.tsx]
        C7[stat-cards.tsx]
    end

    subgraph "pages/ (Composition)"
        P1[marketplace-page.tsx]
        P2[marketplace-detail-page.tsx]
    end

    ROOT --> L1 & L2 & L3 & L4
    ROOT --> S1
    ROOT --> C1 & C2 & C3 & C4 & C5 & C6 & C7
    ROOT --> P1 & P2

    S1 -->|imports| L3 & L4
    P1 -->|uses| S1
    P1 -->|renders| C1 & C2 & C3 & C7
    P2 -->|renders| C4 & C5 & C6

    style ROOT fill:#ffd,stroke:#333,stroke-width:2px
    style L1 fill:#bfb
    style S1 fill:#fbf
    style C1 fill:#bbf
    style P1 fill:#fbb
```

---

## 5. Registry Architecture

```mermaid
graph LR
    subgraph "GitHub Repo: aidd-md/registry"
        MR[mcp-servers.json<br/>MCP server entries]
        CR[content.json<br/>Skills, workflows, rules]
        META[meta.json<br/>Schema version, updated_at]
    end

    subgraph "registry.ts"
        FETCH[fetchCatalog<br/>raw.githubusercontent.com]
        CACHE[In-Memory Cache<br/>Zustand store]
        FALLBACK[Static Seed Data<br/>baked into app]
        PERSIST[Tauri Cache<br/>.aidd/cache/marketplace/<br/>optional]
    end

    MR & CR & META -->|HTTP GET| FETCH
    FETCH -->|success| CACHE
    FETCH -->|error| FALLBACK
    FALLBACK --> CACHE
    CACHE -.->|optional| PERSIST

    style FETCH fill:#bfb,stroke:#333
    style CACHE fill:#fbf,stroke:#333
    style FALLBACK fill:#ffb,stroke:#333
    style PERSIST fill:#ddd,stroke:#333,stroke-dasharray:5
```

---

## 6. Install Flow

```mermaid
graph TD
    ENTRY[Entry Detail Page]

    ENTRY --> COPY[Copy to Clipboard<br/>Primary action]
    ENTRY --> DIRECT[Install Directly<br/>Secondary action]

    COPY --> CLIP[Config JSON in clipboard]
    CLIP --> PASTE[User pastes into<br/>config file manually]

    DIRECT --> DIALOG[InstallDialog opens]
    DIALOG --> SELECT[Select config target<br/>~/.claude/config.json<br/>.cursor/mcp.json<br/>Custom path]
    SELECT --> PREVIEW[Preview changes]
    PREVIEW --> CONFIRM[Confirm write]
    CONFIRM --> WRITE[Tauri fs.writeTextFile<br/>merge into existing config]
    WRITE --> DONE[Success notification]

    style COPY fill:#bfb,stroke:#333,stroke-width:2px
    style DIRECT fill:#ffb,stroke:#333
    style DIALOG fill:#bbf,stroke:#333
    style WRITE fill:#fbf,stroke:#333
```

---

## 7. Page Layout — Marketplace

```mermaid
graph TB
    subgraph "MarketplacePage"
        direction TB
        HEADER[Page Header<br/>Title · Description · StatCards]
        TABS[Tabs<br/>MCP Servers · Skills & Content]
        FILTER[FilterBar<br/>Search · Category Chips · Sort · View Toggle]

        subgraph "View"
            GRID[Grid View<br/>MarketplaceCard × n<br/>3/2/1 columns responsive]
            LIST[List View<br/>MarketplaceTable<br/>sortable columns]
        end

        EMPTY[Empty State<br/>No results matching filters]
        LOADING[Skeleton Grid<br/>Loading state]
        STALE[Stale Badge<br/>Using cached data]
    end

    HEADER --> TABS --> FILTER --> GRID & LIST
    FILTER -.-> EMPTY
    FILTER -.-> LOADING
    FILTER -.-> STALE

    style HEADER fill:#ffd
    style TABS fill:#bbf
    style FILTER fill:#bfb
    style GRID fill:#fbf
    style LIST fill:#fbf
```
